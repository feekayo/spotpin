/**
 * this route handles all requests for categories
 */
var http = require('http');
var express = require('express');
var router = express.Router();
// var router = require('router');
var app = express();
var url = require('url');
var mongodb = require("mongodb");
var ObjectID = mongodb.ObjectID;
var memories = require('modules/memories');
var mongoose = require('mongoose');
var memories_service = require('models/memories');

var MEMORIES_COLLECTION = "memories";

// Create a database variable outside of the database connection callback to
// reuse the connection pool in your app.
var db;



// Get Routes

router.get('/memories/:id', function(request, response) {
	response.send(JSON.stringify(memories.query(request.params.id)))
});

router.get('/', function(request, response) {
	var get_params = url.parse(request.url, true).query;
					if (Object.keys(get_params).length == 2) {
						var arg = get_params.arg;
						var value = get_params.value;
						if (arg != '' && value != '' && arg != null
								&& value != null) {
							response.send(JSON.stringify(memories.query_by_arg(
									arg, value)));
						} else {
							response
									.send('Hmmmm... something\'s not right, Are you sure you specified the URI in the right format?')
						}

					} else if (Object.keys(get_params).length == 0) {
						// response.send('All Results');
						response.send(JSON.stringify(memories.list()));
					} else {
						response
								.send('Hmmmm... something\'s not right, Are you sure you specified the URI in the right format?')
					}

});

router.post('/', function(requestBody, response) {
	requestBody.id = 59;
	requestBody.first_name = "ifeoo";
	memories_service.create(memories_service.Recording, requestBody, response);
	memories_service.list(memories_service.Recording,  response);
});

module.exports = router;